"use client";
import { fetchAPI, deleteAPI, postAPI, patchAPI } from '@/lib/fetchAPI';
import { toast } from "sonner";


import { useState, useEffect } from "react";
import {
Â  Users,
Â  Plus,
Â  Search,
Â  Edit,
Â  Trash2,
Â  Building2,
Â  User as UserIcon,
Â  Mail,
Â  Phone as PhoneIcon,
Â  ChevronLeft,
Â  ChevronRight,
Â  Truck,
} from "lucide-react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";


import { ClientFormModal } from "@/components/clients/ClientFormModal";
import { DriverFormModal } from "@/components/clients/DriverFormModal";
import { apiClient } from "@/lib/api-client";
import { maskCPF, maskCNPJ, maskPhone } from "@/utils/masks";


type ClientType = "PF" | "PJ";


interface Client {
Â  id: string;
Â  type: ClientType;
Â  status?: "ATIVO" | "INADIMPLENTE" | "BLOQUEADO";
Â  name?: string;
Â  cpf?: string;
Â  cnpj?: string;
Â  phone?: string;
Â  whatsapp?: string;
Â  email?: string;
Â  cep?: string;
Â  logradouro?: string;
Â  numero?: string;
Â  complemento?: string;
Â  bairro?: string;
Â  cidade?: string;
Â  uf?: string;
}


interface Driver {
Â  id: string;
Â  name: string;
Â  cpf: string;
Â  cnh: string;
Â  cnhCategory: string;
Â  cnhExpiration?: string;
Â  telefone: string;
Â  status: "ATIVO" | "INATIVO";
Â  clientId: string;
Â  client?: { id: string; name: string };
}


type ClientsResponse = Client[] | { items: Client[]; total: number };
type DriversResponse = Driver[] | { items: Driver[]; total: number };


const normalizeClients = (data: any): { items: Client[]; total: number } => {
Â  if (data.items && typeof data.total === "number") return data;
Â  if (Array.isArray(data)) return { items: data, total: data.length };
Â  return { items: [], total: 0 };
};


const normalizeDrivers = (data: any): { items: Driver[]; total: number } => {
Â  if (data.items && typeof data.total === "number") return data;
Â  if (Array.isArray(data)) return { items: data, total: data.length };
Â  return { items: [], total: 0 };
};


export default function ClientsPage() {
Â  const queryClient = useQueryClient();
Â  const [tab, setTab] = useState<"clients" | "drivers">("clients");
Â  const [search, setSearch] = useState("");
Â  const [typeFilter, setTypeFilter] = useState<"all" | ClientType>("all");
Â  const [statusFilter, setStatusFilter] = useState<"all" | "ATIVO" | "INADIMPLENTE" | "BLOQUEADO">(
Â  Â  "all"
Â  );
Â  const [page, setPage] = useState(1);
Â  const pageSize = 10;
Â  const [isModalOpen, setIsModalOpen] = useState(false);
Â  const [editing, setEditing] = useState<Client | null>(null);
Â  const [driverSearch, setDriverSearch] = useState("");
Â  const [driverPage, setDriverPage] = useState(1);
Â  const [isDriverModalOpen, setIsDriverModalOpen] = useState(false);
Â  const [editingDriver, setEditingDriver] = useState<Driver | null>(null);


Â  const { data: clientsData, isLoading: clientsLoading } = useQuery({
Â  Â  queryKey: ["clients", { search, typeFilter, statusFilter, page, pageSize }],
Â  Â  queryFn: async () => {
Â  Â  Â  const params = new URLSearchParams();
Â  Â  Â  if (search) params.set("search", search);
Â  Â  Â  if (typeFilter !== "all") params.set("type", typeFilter);
Â  Â  Â  if (statusFilter !== "all") params.set("status", statusFilter);
Â  Â  Â  params.set("page", String(page));
Â  Â  Â  params.set("limit", String(pageSize));
Â  Â  Â  const data = await apiClient.get<ClientsResponse>("/clients?" + params.toString());
Â  Â  Â  return normalizeClients(data);
Â  Â  },
Â  });


Â  const { data: driversData, isLoading: driversLoading } = useQuery({
Â  Â  queryKey: ["drivers", { search: driverSearch, page: driverPage }],
Â  Â  queryFn: async () => {
Â  Â  Â  const params = new URLSearchParams();
Â  Â  Â  if (driverSearch) params.set("search", driverSearch);
Â  Â  Â  params.set("page", String(driverPage));
Â  Â  Â  params.set("limit", String(pageSize));
Â  Â  Â  const data = await apiClient.get<DriversResponse>("/drivers?" + params.toString());
Â  Â  Â  return normalizeDrivers(data);
Â  Â  },
Â  });


Â  const clients = clientsData?.items ?? [];
Â  const clientsTotal = clientsData?.total ?? clients.length;
Â  const clientsTotalPages = Math.max(1, Math.ceil(clientsTotal / pageSize));
Â  const clientsHasPrev = page > 1;
Â  const clientsHasNext = page < clientsTotalPages;


Â  const drivers = driversData?.items ?? [];


Â  // Filtra apenas PJ para motoristas
Â  const pjClients = clients.filter((c) => c.type === "PJ");
Â  const driversTotal = driversData?.total ?? drivers.length;
Â  const driversTotalPages = Math.max(1, Math.ceil(driversTotal / pageSize));
Â  const driversHasPrev = driverPage > 1;
Â  const driversHasNext = driverPage < driversTotalPages;


Â  const saveMutation = useMutation({
Â  Â  mutationFn: async (payload: Partial<Client>) => {
Â  Â  Â  const isUpdate = Boolean(payload.id);
Â  Â  Â  const clientId = payload.id;
Â  Â  Â  const endpoint = isUpdate ? "/clients/" + clientId : "/clients";


Â  Â  Â  const { id, ...dataToSend } = payload;
Â  Â  Â  const body = isUpdate ? dataToSend : payload;


Â  Â  Â  console.log("ğŸ› DEBUG CLIENT:", { isUpdate, endpoint, body });


Â  Â  Â  if (isUpdate) {
Â  Â  Â  Â  return apiClient.patch<Client>(endpoint, body);
Â  Â  Â  } else {
Â  Â  Â  Â  return apiClient.post<Client>(endpoint, body);
Â  Â  Â  }
Â  Â  },
Â  Â  onSuccess: () => {
Â  Â  Â  toast.success("Cliente salvo com sucesso!");
Â  Â  Â  setIsModalOpen(false);
Â  Â  Â  setEditing(null);
Â  Â  Â  queryClient.invalidateQueries({ queryKey: ["clients"] });
Â  Â  },
Â  Â  onError: () => toast.error("Erro ao salvar cliente"),
Â  });


Â  const saveDriverMutation = useMutation({
Â  Â  mutationFn: async (payload: Partial<Driver>) => {
Â  Â  Â  const isUpdate = Boolean(payload.id);
Â  Â  Â  const driverId = payload.id;


Â  Â  Â  if (isUpdate && editingDriver?.clientId && payload.clientId !== editingDriver.clientId) {
Â  Â  Â  Â  console.log("ğŸ”„ DETECTOU MUDANÃ‡A DE CLIENTE - Fazendo migraÃ§Ã£o...");
<<<<<<< HEAD
Â  Â  Â  Â  const response = await fetch(`/drivers/${driverId}/migrate`, {
=======
Â  Â  Â  Â  const response = await fetch(`/api/backend/drivers/${driverId}/migrate`, {
>>>>>>> 91c73f5
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  body: JSON.stringify({ newClientId: payload.clientId }),
Â  Â  Â  Â  });


Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  const error = await response.json();
Â  Â  Â  Â  Â  throw new Error(error.message || 'Erro ao migrar motorista');
Â  Â  Â  Â  }


Â  Â  Â  Â  return response.json();
Â  Â  Â  }


Â  Â  Â  const endpoint = isUpdate ? "/drivers/" + driverId : "/drivers";
Â  Â  Â  const method = isUpdate ? "patch" : "post";


Â  Â  Â  const { id, ...dataToSend } = payload;
Â  Â  Â  const body = isUpdate ? dataToSend : payload;


Â  Â  Â  console.log("ğŸ› DEBUG:", { isUpdate, method, endpoint, body });
Â  Â  Â  
Â  Â  Â  if (method === "patch") {
Â  Â  Â  Â  return await apiClient.patch<Driver>(endpoint, body);
Â  Â  Â  } else {
Â  Â  Â  Â  return await apiClient.post<Driver>(endpoint, body);
Â  Â  Â  }
Â  Â  },
Â  Â  onSuccess: () => {
Â  Â  Â  toast.success("Motorista salvo com sucesso!");
Â  Â  Â  setIsDriverModalOpen(false);
Â  Â  Â  setEditingDriver(null);
Â  Â  Â  queryClient.invalidateQueries({ queryKey: ["drivers"] });
Â  Â  },
Â  Â  onError: (error: any) => {
Â  Â  Â  console.log('ğŸ”¥ ERRO NO MUTATION:', error);
Â  Â  Â  if (error?.response?.status !== 409) {
Â  Â  Â  Â  toast.error('Erro ao salvar motorista');
Â  Â  Â  }
Â  Â  },
Â  });


Â  const deleteMutation = useMutation({
Â  Â  mutationFn: async (id: string) => apiClient.delete("/clients/" + id),
Â  Â  onSuccess: () => {
Â  Â  Â  toast.success("Cliente removido com sucesso!");
Â  Â  Â  queryClient.invalidateQueries({ queryKey: ["clients"] });
Â  Â  },
Â  Â  onError: (error: any) => {
Â  Â  Â  console.error("âŒ ERRO AO DELETAR CLIENTE:", error);
Â  Â  Â  alert("NÃ£o foi possÃ­vel remover o cliente. ERRO: " + (error.message || "desconhecido"));
Â  Â  },
Â  });


Â  const deleteDriverMutation = useMutation({
Â  Â  mutationFn: async (id: string) => apiClient.delete("/drivers/" + id),
Â  Â  onSuccess: () => {
Â  Â  Â  toast.success("Motorista removido com sucesso!");
Â  Â  Â  queryClient.invalidateQueries({ queryKey: ["drivers"] });
Â  Â  },
Â  Â  onError: (error: any) => {
Â  Â  Â  console.error("âŒ ERRO AO DELETAR MOTORISTA:", error);
Â  Â  Â  alert("NÃ£o foi possÃ­vel remover o motorista. ERRO: " + (error.message || "desconhecido"));
Â  Â  },
Â  });


Â  useEffect(() => setPage(1), [search, typeFilter, statusFilter]);
Â  useEffect(() => setDriverPage(1), [driverSearch]);


Â  const handleNewClient = () => {
Â  Â  setEditing(null);
Â  Â  setIsModalOpen(true);
Â  };
Â  const handleEditClient = (c: Client) => {
Â  Â  setEditing(c);
Â  Â  setIsModalOpen(true);
Â  };
Â  const handleDeleteClient = (c: Client) => {
Â  Â  if (!c?.id) return;
Â  Â  if (window.confirm(`Remover o cliente "${c.name ?? ""}"?`)) deleteMutation.mutate(c.id);
Â  };
Â  const handleNewDriver = () => {
Â  Â  setEditingDriver(null);
Â  Â  setIsDriverModalOpen(true);
Â  };
Â  const handleEditDriver = (d: Driver) => {
Â  Â  setEditingDriver(d);
Â  Â  setIsDriverModalOpen(true);
Â  };
Â  const handleDeleteDriver = (d: Driver) => {
Â  Â  if (!d?.id) return;
Â  Â  if (window.confirm(`Remover o motorista "${d.name}"?`)) deleteDriverMutation.mutate(d.id);
Â  };


Â  if (tab === "clients" && clientsLoading) return <div className="p-6">Carregando clientes...</div>;
Â  if (tab === "drivers" && driversLoading)
Â  Â  return <div className="p-6">Carregando motoristas...</div>;


Â  return (
Â  Â  <div className="flex flex-col gap-6 p-6">
Â  Â  Â  {/* ğŸ¨ HEADER COM ABAS FIXAS E MELHORADAS */}
Â  Â  Â  <div className="flex items-center justify-between">
Â  Â  Â  Â  <div className="flex items-center gap-6">
Â  Â  Â  Â  Â  <div className="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  <Users className="w-6 h-6 text-teal-600" />
Â  Â  Â  Â  Â  Â  <h1 className="text-2xl font-bold text-slate-800">Clientes</h1>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  {/* âœ¨ ABAS SEMPRE VISÃVEIS COM VISUAL MELHORADO */}
Â  Â  Â  Â  Â  <div className="flex gap-2 bg-slate-100 rounded-lg p-1">
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  onClick={() => setTab("clients")}
Â  Â  Â  Â  Â  Â  Â  className={
Â  Â  Â  Â  Â  Â  Â  Â  "flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-all " +
Â  Â  Â  Â  Â  Â  Â  Â  (tab === "clients"
Â  Â  Â  Â  Â  Â  Â  Â  Â  ? "bg-white text-teal-700 shadow-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  : "text-slate-600 hover:text-slate-900")
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <UserIcon className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Clientes
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  onClick={() => setTab("drivers")}
Â  Â  Â  Â  Â  Â  Â  className={
Â  Â  Â  Â  Â  Â  Â  Â  "flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-all " +
Â  Â  Â  Â  Â  Â  Â  Â  (tab === "drivers"
Â  Â  Â  Â  Â  Â  Â  Â  Â  ? "bg-white text-teal-700 shadow-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  : "text-slate-600 hover:text-slate-900")
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <Truck className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Motoristas
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  {tab === "clients" && (
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  onClick={handleNewClient}
Â  Â  Â  Â  Â  Â  className="inline-flex items-center gap-2 rounded-lg bg-teal-600 text-white px-5 py-2.5 hover:bg-teal-700 font-medium shadow-sm transition-all"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <Plus className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Novo Cliente
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  )}
Â  Â  Â  Â  {tab === "drivers" && (
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  onClick={handleNewDriver}
Â  Â  Â  Â  Â  Â  className="inline-flex items-center gap-2 rounded-lg bg-teal-600 text-white px-5 py-2.5 hover:bg-teal-700 font-medium shadow-sm transition-all"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <Plus className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Novo Motorista
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  )}
Â  Â  Â  </div>


Â  Â  Â  {tab === "clients" && (
Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  <div className="flex flex-col md:flex-row gap-3">
Â  Â  Â  Â  Â  Â  <div className="relative flex-1">
Â  Â  Â  Â  Â  Â  Â  <Search className="w-4 h-4 absolute left-3 top-3 text-slate-400" />
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  value={search}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setSearch(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-200 focus:border-teal-400"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Buscar por nome, CPF, CNPJ..."
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  value={typeFilter}
Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setTypeFilter(e.target.value as any)}
Â  Â  Â  Â  Â  Â  Â  className="px-4 py-2.5 rounded-lg border border-slate-200 bg-white focus:outline-none focus:ring-2 focus:ring-teal-200"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <option value="all">Tipo: Todos</option>
Â  Â  Â  Â  Â  Â  Â  <option value="PF">Pessoa FÃ­sica</option>
Â  Â  Â  Â  Â  Â  Â  <option value="PJ">Pessoa JurÃ­dica</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  value={statusFilter}
Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setStatusFilter(e.target.value as any)}
Â  Â  Â  Â  Â  Â  Â  className="px-4 py-2.5 rounded-lg border border-slate-200 bg-white focus:outline-none focus:ring-2 focus:ring-teal-200"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <option value="all">Status: Todos</option>
Â  Â  Â  Â  Â  Â  Â  <option value="ATIVO">Ativos</option>
Â  Â  Â  Â  Â  Â  Â  <option value="INADIMPLENTE">Inadimplentes</option>
Â  Â  Â  Â  Â  Â  Â  <option value="BLOQUEADO">Bloqueados</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
Â  Â  Â  Â  Â  Â  <table className="min-w-full text-sm">
Â  Â  Â  Â  Â  Â  Â  <thead className="bg-slate-50 border-b border-slate-200">
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Nome</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Tipo</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Documento</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Telefone</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">E-mail</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-right px-4 py-3 font-semibold text-slate-700 w-24">AÃ§Ãµes</th>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  {clients.length ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  clients.map((c) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr key={c.id} className="border-t border-slate-100 hover:bg-slate-50 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {c.type === "PJ" ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Building2 className="w-4 h-4 text-slate-400" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <UserIcon className="w-4 h-4 text-slate-400" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-medium text-slate-900">{c.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className={c.type === "PJ" ? "text-blue-700" : "text-green-700"}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {c.type}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-slate-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {c.type === "PF" ? maskCPF(c.cpf || "") : maskCNPJ(c.cnpj || "")}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-1 text-slate-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <PhoneIcon className="w-4 h-4 text-slate-400" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {maskPhone(c.phone || "") || "-"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-1 text-slate-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Mail className="w-4 h-4 text-slate-400" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {c.email || "â€”"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="inline-flex gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handleEditClient(c)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg hover:bg-slate-100 text-slate-600 hover:text-teal-600 transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Editar"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Edit className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handleDeleteClient(c)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg hover:bg-red-50 text-slate-600 hover:text-red-600 transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Excluir"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-8 text-center text-slate-400" colSpan={6}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Nenhum cliente encontrado.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  <div className="flex items-center justify-between px-4 py-3 border-t bg-slate-50">
Â  Â  Â  Â  Â  Â  Â  <span className="text-sm text-slate-600">
Â  Â  Â  Â  Â  Â  Â  Â  PÃ¡gina {page} de {clientsTotalPages}
Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled={!clientsHasPrev}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setPage((p) => Math.max(1, p - 1))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg border border-slate-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronLeft className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled={!clientsHasNext}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setPage((p) => p + 1)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg border border-slate-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  <ClientFormModal
Â  Â  Â  Â  Â  Â  isOpen={isModalOpen}
Â  Â  Â  Â  Â  Â  onClose={() => {
Â  Â  Â  Â  Â  Â  Â  setIsModalOpen(false);
Â  Â  Â  Â  Â  Â  Â  setEditing(null);
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  onSubmit={(data) => saveMutation.mutate(data)}
Â  Â  Â  Â  Â  Â  initialData={editing}
Â  Â  Â  Â  Â  Â  title={editing ? "Editar Cliente" : "Novo Cliente"}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </>
Â  Â  Â  )}


Â  Â  Â  {tab === "drivers" && (
Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  <div className="flex flex-col md:flex-row gap-3">
Â  Â  Â  Â  Â  Â  <div className="relative flex-1">
Â  Â  Â  Â  Â  Â  Â  <Search className="w-4 h-4 absolute left-3 top-3 text-slate-400" />
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  value={driverSearch}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setDriverSearch(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-200 focus:border-teal-400"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Buscar por nome, CPF, CNH..."
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
Â  Â  Â  Â  Â  Â  <table className="min-w-full text-sm">
Â  Â  Â  Â  Â  Â  Â  <thead className="bg-slate-50 border-b border-slate-200">
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Nome</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Empresa</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">CPF</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">CNH</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Categoria</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Telefone</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-left px-4 py-3 font-semibold text-slate-700">Status</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <th className="text-right px-4 py-3 font-semibold text-slate-700 w-24">AÃ§Ãµes</th>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  {drivers.length ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  drivers.map((d) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr key={d.id} className="border-t border-slate-100 hover:bg-slate-50 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 font-medium text-slate-900">{d.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-slate-600">{d.client?.name || "â€”"}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-slate-600">{maskCPF(d.cpf || "")}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-slate-600">{d.cnh}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-slate-600">{d.cnhCategory}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-slate-600">{maskPhone(d.telefone || "")}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.status === "ATIVO"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? "px-2 py-1 text-xs font-medium bg-teal-100 text-teal-700 rounded-full"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : "px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {d.status === "ATIVO" ? "Ativo" : "Inativo"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-3 text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="inline-flex gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handleEditDriver(d)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg hover:bg-slate-100 text-slate-600 hover:text-teal-600 transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Editar"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Edit className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handleDeleteDriver(d)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg hover:bg-red-50 text-slate-600 hover:text-red-600 transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Excluir"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td className="px-4 py-8 text-center text-slate-400" colSpan={8}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Nenhum motorista encontrado.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  <div className="flex items-center justify-between px-4 py-3 border-t bg-slate-50">
Â  Â  Â  Â  Â  Â  Â  <span className="text-sm text-slate-600">
Â  Â  Â  Â  Â  Â  Â  Â  PÃ¡gina {driverPage} de {driversTotalPages}
Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled={!driversHasPrev}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setDriverPage((p) => Math.max(1, p - 1))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg border border-slate-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronLeft className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled={!driversHasNext}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setDriverPage((p) => p + 1)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="p-2 rounded-lg border border-slate-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white transition-colors"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight className="w-4 h-4" />
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  <DriverFormModal
Â  Â  Â  Â  Â  Â  isOpen={isDriverModalOpen}
Â  Â  Â  Â  Â  Â  onClose={() => {
Â  Â  Â  Â  Â  Â  Â  setIsDriverModalOpen(false);
Â  Â  Â  Â  Â  Â  Â  setEditingDriver(null);
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  onSubmit={(data) => saveDriverMutation.mutateAsync(data)}
Â  Â  Â  Â  Â  Â  initialData={editingDriver}
Â  Â  Â  Â  Â  Â  title={editingDriver ? "Editar Motorista" : "Novo Motorista"}
Â  Â  Â  Â  Â  Â  clients={pjClients}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </>
Â  Â  Â  )}
Â  Â  </div>
Â  );
}



"use client";
import { fetchAPI, deleteAPI, postAPI, patchAPI } from '@/lib/fetchAPI';


import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Select } from "@/components/ui/select";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Plus, Edit, Trash2, User, Search } from "lucide-react";


interface Driver {
Â  id: string;
Â  nome: string;
Â  cpf: string;
Â  cnh: string;
Â  cnhCategoria: string;
Â  cnhValidade: string;
Â  telefone?: string;
Â  email?: string;
Â  clientId: string;
Â  client?: {
Â  Â  nomeFantasia?: string;
Â  Â  razaoSocial: string;
Â  };
}


export default function DriversPage() {
Â  const [drivers, setDrivers] = useState<Driver[]>([]);
Â  const [clients, setClients] = useState<any[]>([]);
Â  const [loading, setLoading] = useState(true);
Â  const [showModal, setShowModal] = useState(false);
Â  const [editingDriver, setEditingDriver] = useState<Driver | null>(null);
Â  const [searchTerm, setSearchTerm] = useState("");


Â  const [formData, setFormData] = useState({
Â  Â  nome: "",
Â  Â  cpf: "",
Â  Â  cnh: "",
Â  Â  cnhCategoria: "B",
Â  Â  cnhValidade: "",
Â  Â  telefone: "",
Â  Â  email: "",
Â  Â  clientId: "",
Â  });


Â  useEffect(() => {
Â  Â  carregarDados();
Â  }, []);


Â  const carregarDados = async () => {
Â  Â  try {
Â  Â  Â  const [driversRes, clientsRes] = await Promise.all([
<<<<<<< HEAD
Â  Â  Â  Â  fetch("/drivers"),
Â  Â  Â  Â  fetch("/clients"),
=======
Â  Â  Â  Â  fetch("/api/backend/drivers"),
Â  Â  Â  Â  fetch("/api/backend/clients"),
>>>>>>> 91c73f5
Â  Â  Â  ]);


Â  Â  Â  setDrivers(await driversRes.json());
Â  Â  Â  setClients(await clientsRes.json());
Â  Â  } catch (error) {
Â  Â  Â  console.error("Erro ao carregar dados:", error);
Â  Â  } finally {
Â  Â  Â  setLoading(false);
Â  Â  }
Â  };


Â  const abrirModal = (driver?: Driver) => {
Â  Â  if (driver) {
Â  Â  Â  setEditingDriver(driver);
Â  Â  Â  setFormData({
Â  Â  Â  Â  nome: driver.nome,
Â  Â  Â  Â  cpf: driver.cpf,
Â  Â  Â  Â  cnh: driver.cnh,
Â  Â  Â  Â  cnhCategoria: driver.cnhCategoria,
Â  Â  Â  Â  cnhValidade: driver.cnhValidade.split("T")[0],
Â  Â  Â  Â  telefone: driver.telefone || "",
Â  Â  Â  Â  email: driver.email || "",
Â  Â  Â  Â  clientId: driver.clientId,
Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  setEditingDriver(null);
Â  Â  Â  setFormData({
Â  Â  Â  Â  nome: "",
Â  Â  Â  Â  cpf: "",
Â  Â  Â  Â  cnh: "",
Â  Â  Â  Â  cnhCategoria: "B",
Â  Â  Â  Â  cnhValidade: "",
Â  Â  Â  Â  telefone: "",
Â  Â  Â  Â  email: "",
Â  Â  Â  Â  clientId: "",
Â  Â  Â  });
Â  Â  }
Â  Â  setShowModal(true);
Â  };


Â  const salvarMotorista = async () => {
Â  Â  try {
Â  Â  Â  const url = editingDriver
<<<<<<< HEAD
Â  Â  Â  Â  ? `/drivers/${editingDriver.id}`
Â  Â  Â  Â  : "/drivers";
=======
Â  Â  Â  Â  ? `/api/backend/drivers/${editingDriver.id}`
Â  Â  Â  Â  : "/api/backend/drivers";
>>>>>>> 91c73f5


Â  Â  Â  const response = await fetch(url, {
Â  Â  Â  Â  method: editingDriver ? "PUT" : "POST",
Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  body: JSON.stringify(formData),
Â  Â  Â  });


Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  alert(`âœ… Motorista ${editingDriver ? "atualizado" : "criado"} com sucesso!`);
Â  Â  Â  Â  setShowModal(false);
Â  Â  Â  Â  carregarDados();
Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  alert("âŒ Erro ao salvar motorista");
Â  Â  }
Â  };


Â  const excluirMotorista = async (id: string) => {
Â  Â  if (!confirm("Tem certeza que deseja excluir este motorista?")) return;


Â  Â  try {
<<<<<<< HEAD
Â  Â  Â  await fetch(`/drivers/${id}`, { method: "DELETE" });
=======
Â  Â  Â  await fetch(`/api/backend/drivers/${id}`, { method: "DELETE" });
>>>>>>> 91c73f5
Â  Â  Â  alert("âœ… Motorista excluÃ­do!");
Â  Â  Â  carregarDados();
Â  Â  } catch (error) {
Â  Â  Â  alert("âŒ Erro ao excluir motorista");
Â  Â  }
Â  };


Â  const driversFiltrados = drivers.filter(
Â  Â  (d) =>
Â  Â  Â  d.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
Â  Â  Â  d.cpf.includes(searchTerm) ||
Â  Â  Â  d.cnh.includes(searchTerm)
Â  );


Â  if (loading) return <div className="p-8">â³ Carregando...</div>;


Â  return (
Â  Â  <div className="p-8 space-y-6">
Â  Â  Â  {/* Header */}
Â  Â  Â  <div className="flex justify-between items-center">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h1 className="text-3xl font-bold flex items-center gap-2">
Â  Â  Â  Â  Â  Â  <User className="h-8 w-8" />
Â  Â  Â  Â  Â  Â  Motoristas
Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  <p className="text-gray-500">Gerencie os motoristas cadastrados</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <Button onClick={() => abrirModal()}>
Â  Â  Â  Â  Â  <Plus className="mr-2 h-4 w-4" />
Â  Â  Â  Â  Â  Novo Motorista
Â  Â  Â  Â  </Button>
Â  Â  Â  </div>


Â  Â  Â  {/* Busca */}
Â  Â  Â  <Card>
Â  Â  Â  Â  <CardContent className="pt-6">
Â  Â  Â  Â  Â  <div className="relative">
Â  Â  Â  Â  Â  Â  <Search className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  placeholder="Buscar por nome, CPF ou CNH..."
Â  Â  Â  Â  Â  Â  Â  value={searchTerm}
Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setSearchTerm(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  className="pl-10"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </CardContent>
Â  Â  Â  </Card>


Â  Â  Â  {/* Lista */}
Â  Â  Â  <div className="grid gap-4">
Â  Â  Â  Â  {driversFiltrados.length === 0 ? (
Â  Â  Â  Â  Â  <Card>
Â  Â  Â  Â  Â  Â  <CardContent className="pt-6 text-center text-gray-500">
Â  Â  Â  Â  Â  Â  Â  Nenhum motorista encontrado
Â  Â  Â  Â  Â  Â  </CardContent>
Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  driversFiltrados.map((driver) => (
Â  Â  Â  Â  Â  Â  <Card key={driver.id} className="hover:shadow-md transition-shadow">
Â  Â  Â  Â  Â  Â  Â  <CardContent className="pt-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-semibold">{driver.nome}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 gap-2 mt-2 text-sm text-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>ğŸ“„ CPF: {driver.cpf}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>ğŸš— CNH: {driver.cnh}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>ğŸ« Categoria: {driver.cnhCategoria}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>ğŸ“… Validade: {new Date(driver.cnhValidade).toLocaleDateString("pt-BR")}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {driver.telefone && <p>ğŸ“ {driver.telefone}</p>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {driver.email && <p>âœ‰ï¸ {driver.email}</p>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {driver.client && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-blue-600 mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘¤ Cliente: {driver.client.nomeFantasia || driver.client.razaoSocial}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Button variant="outline" size="sm" onClick={() => abrirModal(driver)}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Edit className="h-4 w-4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  variant="outline"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  size="sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => excluirMotorista(driver.id)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 className="h-4 w-4 text-red-500" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </CardContent>
Â  Â  Â  Â  Â  Â  </Card>
Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  )}
Â  Â  Â  </div>


Â  Â  Â  {/* Modal */}
Â  Â  Â  <Dialog open={showModal} onOpenChange={setShowModal}>
Â  Â  Â  Â  <DialogContent>
Â  Â  Â  Â  Â  <DialogHeader>
Â  Â  Â  Â  Â  Â  <DialogTitle>
Â  Â  Â  Â  Â  Â  Â  {editingDriver ? "âœï¸ Editar Motorista" : "â• Novo Motorista"}
Â  Â  Â  Â  Â  Â  </DialogTitle>
Â  Â  Â  Â  Â  </DialogHeader>


Â  Â  Â  Â  Â  <div className="space-y-4">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">Nome *</label>
Â  Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.nome}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, nome: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Nome completo"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">CPF *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cpf}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, cpf: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="000.000.000-00"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">CNH *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnh}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, cnh: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="NÃºmero da CNH"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">Categoria *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <Select
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnhCategoria}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, cnhCategoria: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="A">A</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="B">B</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="AB">AB</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="C">C</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="D">D</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="E">E</option>
Â  Â  Â  Â  Â  Â  Â  Â  </Select>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">Validade CNH *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="date"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnhValidade}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, cnhValidade: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">Telefone</label>
Â  Â  Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.telefone}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, telefone: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="(00) 00000-0000"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  <Input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="email"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.email}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, email: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="email@exemplo.com"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-medium">Cliente *</label>
Â  Â  Â  Â  Â  Â  Â  <Select
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.clientId}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setFormData({ ...formData, clientId: e.target.value })}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Selecione um cliente</option>
Â  Â  Â  Â  Â  Â  Â  Â  {clients.map((client) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option key={client.id} value={client.id}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {client.nomeFantasia || client.razaoSocial}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </option>
Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  </Select>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="flex gap-2 pt-4">
Â  Â  Â  Â  Â  Â  Â  <Button onClick={salvarMotorista} className="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’¾ Salvar
Â  Â  Â  Â  Â  Â  Â  </Button>
Â  Â  Â  Â  Â  Â  Â  <Button variant="outline" onClick={() => setShowModal(false)} className="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  âŒ Cancelar
Â  Â  Â  Â  Â  Â  Â  </Button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </DialogContent>
Â  Â  Â  </Dialog>
Â  Â  </div>
Â  );
} import { fetchAPI, deleteAPI, postAPI, patchAPI } from "@/lib/fetchAPI";
import React, { useState, useEffect } from "react";
import { toast } from 'sonner';
import { Save, X } from "lucide-react";
import { maskCPF, maskPhone } from "@/utils/masks";


interface DriverFormModalProps {
Â  isOpen: boolean;
Â  onClose: () => void;
Â  onSubmit: (data: any) => void;
Â  initialData?: any;
Â  title: string;
Â  clients?: any[];
}


export function DriverFormModal({
Â  isOpen,
Â  onClose,
Â  onSubmit,
Â  initialData,
Â  title,
Â  clients = [],
}: DriverFormModalProps) {
Â  const [loading, setLoading] = useState(false);
Â  const [conflictData, setConflictData] = useState<any>(null);
Â  const [showTransferModal, setShowTransferModal] = useState(false);
Â  
Â  useEffect(() => {
Â  Â  const handleConflict = (event: any) => {
Â  Â  Â  console.log('ğŸ“¢ CONFLITO DETECTADO:', event.detail);
Â  Â  Â  setConflictData(event.detail);
Â  Â  Â  setShowTransferModal(true);
Â  Â  };


Â  Â  window.addEventListener('driverConflict', handleConflict as EventListener);
Â  Â  return () => window.removeEventListener('driverConflict', handleConflict as EventListener);
Â  }, []);


Â  const [formData, setFormData] = useState({
Â  Â  name: "",
Â  Â  cpf: "",
Â  Â  cnh: "",
Â  Â  cnhCategory: "",
Â  Â  cnhValidade: "",
Â  Â  telefone: "",
Â  Â  clientId: "",
Â  Â  status: "ATIVO",
Â  });


Â  const formatDateForInput = (dateString: string | undefined | null): string => {
Â  Â  if (!dateString) return "";
Â  Â  try {
Â  Â  Â  const date = new Date(dateString);
Â  Â  Â  if (isNaN(date.getTime())) return "";
Â  Â  Â  return date.toISOString().split("T")[0];
Â  Â  } catch {
Â  Â  Â  return "";
Â  Â  }
Â  };


Â  useEffect(() => {
Â  Â  if (initialData && isOpen) {
Â  Â  Â  setFormData({
Â  Â  Â  Â  name: initialData.name || "",
Â  Â  Â  Â  cpf: initialData.cpf || "",
Â  Â  Â  Â  cnh: initialData.cnh || "",
Â  Â  Â  Â  cnhCategory: initialData.cnhCategory || "",
Â  Â  Â  Â  cnhValidade: formatDateForInput(initialData.cnhValidade),
Â  Â  Â  Â  telefone: initialData.telefone || "",
Â  Â  Â  Â  clientId: initialData.clientId || "",
Â  Â  Â  Â  status: initialData.status || "ATIVO",
Â  Â  Â  });
Â  Â  } else if (!isOpen) {
Â  Â  Â  setFormData({
Â  Â  Â  Â  name: "",
Â  Â  Â  Â  cpf: "",
Â  Â  Â  Â  cnh: "",
Â  Â  Â  Â  cnhCategory: "",
Â  Â  Â  Â  cnhValidade: "",
Â  Â  Â  Â  telefone: "",
Â  Â  Â  Â  clientId: "",
Â  Â  Â  Â  status: "ATIVO",
Â  Â  Â  });
Â  Â  }
Â  }, [initialData, isOpen]);


Â  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
Â  Â  const { name, value } = e.target;
Â  Â  setFormData((prev) => ({ ...prev, [name]: value }));
Â  };


Â  const handleCpfChange = (e: React.ChangeEvent<HTMLInputElement>) => {
Â  Â  const masked = maskCPF(e.target.value);
Â  Â  setFormData((prev) => ({ ...prev, cpf: masked }));
Â  };


Â  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {
Â  Â  const masked = maskPhone(e.target.value);
Â  Â  setFormData((prev) => ({ ...prev, telefone: masked }));
Â  };


Â  const handleSubmit = async (e: React.FormEvent) => {
Â  Â  e.preventDefault();


Â  Â  // ValidaÃ§Ãµes
Â  Â  if (!formData.name.trim()) {
Â  Â  Â  alert("Nome Ã© obrigatÃ³rio");
Â  Â  Â  return;
Â  Â  }
Â  Â  if (!formData.cpf.trim()) {
Â  Â  Â  alert("CPF Ã© obrigatÃ³rio");
Â  Â  Â  return;
Â  Â  }
Â  Â  if (!formData.cnh.trim()) {
Â  Â  Â  alert("CNH Ã© obrigatÃ³ria");
Â  Â  Â  return;
Â  Â  }
Â  Â  if (!formData.cnhCategory.trim()) {
Â  Â  Â  alert("Categoria CNH Ã© obrigatÃ³ria");
Â  Â  Â  return;
Â  Â  }
Â  Â  if (!formData.cnhValidade) {
Â  Â  Â  alert("Data de vencimento da CNH Ã© obrigatÃ³ria");
Â  Â  Â  return;
Â  Â  }
Â  Â  if (!formData.clientId || formData.clientId === "") {
Â  Â  Â  alert("Selecione uma empresa. Motoristas precisam estar vinculados a uma empresa PJ.");
Â  Â  Â  return;
Â  Â  }


Â  Â  setLoading(true);
Â  Â  try {
Â  Â  Â  const driverData: any = {
Â  Â  Â  Â  ...(initialData?.id && { id: initialData.id }),
Â  Â  Â  Â  name: formData.name.trim(),
Â  Â  Â  Â  cpf: formData.cpf.replace(/\D/g, ""),
Â  Â  Â  Â  cnh: formData.cnh.trim(),
Â  Â  Â  Â  cnhCategory: formData.cnhCategory.trim(),
Â  Â  Â  Â  cnhValidade: formData.cnhValidade,
Â  Â  Â  Â  telefone: formData.telefone.replace(/\D/g, ""),
Â  Â  Â  Â  clientId: formData.clientId,
Â  Â  Â  Â  status: formData.status,
Â  Â  Â  };
Â  Â  Â  
Â  Â  Â  console.log("Enviando motorista:", driverData);
Â  Â  Â  await onSubmit(driverData);
Â  Â  Â  onClose();
Â  Â  } catch (error: any) {
Â  Â  Â  console.log("ğŸ”¥ ENTROU NO CATCH!");
Â  Â  Â  console.error("âŒ ERRO COMPLETO:", error);
Â  Â  Â  console.error("âŒ TIPO DO ERRO:", typeof error);
Â  Â  Â  console.error("âŒ ERRO Ã‰ OBJETO?:", error instanceof Object);
Â  Â  Â  console.error("âŒ ERRO.RESPONSE:", error?.response);
Â  Â  Â  console.error("âŒ ERRO.RESPONSE.DATA:", error?.response?.data);
Â  Â  Â  console.error("âŒ ERRO.RESPONSE.STATUS:", error?.response?.status);


Â  Â  Â  if (error?.response?.status === 409 && error?.response?.data?.driver) {
Â  Â  Â  Â  console.log("âœ… DETECTOU 409! Mostrando modal...");
Â  Â  Â  Â  setConflictData(error.response.data);
Â  Â  Â  Â  setShowTransferModal(true);
Â  Â  Â  } else {
Â  Â  Â  Â  console.log("âš ï¸ NÃƒO Ã‰ 409 OU NÃƒO TEM DADOS");
Â  Â  Â  Â  alert("Erro ao salvar: " + (error?.message || JSON.stringify(error)));
Â  Â  Â  }
Â  Â  } finally {
Â  Â  Â  setLoading(false);
Â  Â  }
Â  };


Â  const handleTransfer = async () => {
Â  Â  try {
Â  Â  Â  setLoading(true);
Â  Â  Â  setShowTransferModal(false);


Â  Â  Â  // Usar endpoint de migraÃ§Ã£o do backend
Â  Â  Â  const response = await fetch(`/drivers/${conflictData.driver.id}/migrate`, {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  newClientId: formData.clientId,
Â  Â  Â  Â  }),
Â  Â  Â  });


Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  const error = await response.json();
Â  Â  Â  Â  throw new Error(error.message || 'Erro ao migrar motorista');
Â  Â  Â  }


Â  Â  Â  toast.success('Motorista migrado com sucesso!', {
Â  Â  Â  Â  description: `${conflictData.driver.name} agora estÃ¡ vinculado a este cliente.`,
Â  Â  Â  Â  duration: 4000,
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  onClose();
Â  Â  Â  setConflictData(null);
Â  Â  Â  
Â  Â  Â  // Recarregar dados sem refresh da pÃ¡gina
Â  Â  Â  if (window.location.pathname.includes('/clients')) {
Â  Â  Â  Â  setTimeout(() => window.location.reload(), 1000);
Â  Â  Â  }
Â  Â  } catch (error: any) {
Â  Â  Â  console.error("Erro ao transferir motorista:", error);
Â  Â  Â  toast.error('Erro ao migrar motorista', {
Â  Â  Â  Â  description: error.message,
Â  Â  Â  Â  duration: 5000,
Â  Â  Â  });
Â  Â  Â  setShowTransferModal(true);
Â  Â  } finally {
Â  Â  Â  setLoading(false);
Â  Â  }
Â  };


Â  const handleCancelTransfer = () => {
Â  Â  setShowTransferModal(false);
Â  Â  setConflictData(null);
Â  Â  setLoading(false);
Â  };


Â  if (!isOpen) return null;


Â  return (
Â  Â  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
Â  Â  Â  <div className="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
Â  Â  Â  Â  <div className="sticky top-0 bg-gradient-to-r from-teal-600 to-teal-700 px-6 py-4 flex justify-between items-center">
Â  Â  Â  Â  Â  <h2 className="text-xl font-bold text-white">{title}</h2>
Â  Â  Â  Â  Â  <button onClick={onClose} className="p-1 hover:bg-white/20 rounded transition-colors">
Â  Â  Â  Â  Â  Â  <X size={24} className="text-white" />
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>


Â  Â  Â  Â  <form onSubmit={handleSubmit} className="p-6 space-y-6">
Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Nome Completo *
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  name="name"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.name}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="JoÃ£o Silva"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">CPF *</label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  name="cpf"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cpf}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleCpfChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  maxLength={14}
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="123.456.789-00"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Telefone *</label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="tel"
Â  Â  Â  Â  Â  Â  Â  Â  name="telefone"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.telefone}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handlePhoneChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  maxLength={15}
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="(11) 99999-9999"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">CNH *</label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  name="cnh"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnh}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="12345678901"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Categoria CNH *
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  Â  name="cnhCategory"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnhCategory}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Selecione...</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="A">A</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="B">B</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="AB">AB</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="C">C</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="D">D</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="E">E</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Vencimento CNH *
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="date"
Â  Â  Â  Â  Â  Â  Â  Â  name="cnhValidade"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnhValidade}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Empresa/Cliente *
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  Â  name="clientId"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.clientId}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Selecione uma empresa *</option>
Â  Â  Â  Â  Â  Â  Â  Â  {clients.filter(c => c.type === "PJ").map((client) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <option key={client.id} value={client.id}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {client.name}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </option>
Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Status</label>
Â  Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  Â  name="status"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.status}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <option value="ATIVO">Ativo</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="INATIVO">Inativo</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  <div className="flex gap-4 justify-end pt-4 border-t">
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  Â  onClick={onClose}
Â  Â  Â  Â  Â  Â  Â  disabled={loading}
Â  Â  Â  Â  Â  Â  Â  className="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors disabled:opacity-50"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  type="submit"
Â  Â  Â  Â  Â  Â  Â  disabled={loading}
Â  Â  Â  Â  Â  Â  Â  className="flex items-center gap-2 px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 font-medium transition-colors disabled:opacity-50"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <Save size={18} />
Â  Â  Â  Â  Â  Â  Â  {loading ? "Salvando..." : "Salvar Motorista"}
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>


Â  Â  Â  {/* MODAL DE TRANSFERÃŠNCIA */}
Â  Â  Â  {showTransferModal && conflictData && (
Â  Â  Â  Â  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  <div className="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
Â  Â  Â  Â  Â  Â  <h3 className="text-lg font-bold text-gray-900 mb-4">
Â  Â  Â  Â  Â  Â  Â  âš ï¸ Motorista jÃ¡ cadastrado
Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  <div className="space-y-3 mb-6">
Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  <strong>Nome:</strong> {conflictData.driver.name}
Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  <strong>CPF:</strong> {conflictData.driver.cpf}
Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  <strong>Empresa atual:</strong> {conflictData.driver.company || "Sem vÃ­nculo"}
Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-yellow-800 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Deseja transferir este motorista para a nova empresa?
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="flex gap-3">
Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  onClick={handleCancelTransfer}
Â  Â  Â  Â  Â  Â  Â  Â  className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  onClick={handleTransfer}
Â  Â  Â  Â  Â  Â  Â  Â  className="flex-1 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Transferir
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  )}
Â  Â  </div>
Â  );
} import React, { useState, useEffect, useCallback } from "react";
import { Save, X } from "lucide-react";
import { maskCPF, maskCNPJ, maskPhone } from "@/utils/masks";


interface ClientFormModalProps {
Â  isOpen: boolean;
Â  onClose: () => void;
Â  onSubmit: (data: any) => void;
Â  initialData?: any;
Â  title: string;
}


export function ClientFormModal({
Â  isOpen,
Â  onClose,
Â  onSubmit,
Â  initialData,
Â  title,
}: ClientFormModalProps) {
Â  const [clientType, setClientType] = useState<"PF" | "PJ">("PF");
Â  const [loading, setLoading] = useState(false);
Â  const [formData, setFormData] = useState({
Â  Â  id: "",
Â  Â  name: "",
Â  Â  email: "",
Â  Â  telefone: "",
Â  Â  cpf: "",
Â  Â  cnpj: "",
Â  Â  rg: "",
Â  Â  ie: "",
Â  Â  cep: "",
Â  Â  logradouro: "",
Â  Â  numero: "",
Â  Â  complemento: "",
Â  Â  bairro: "",
Â  Â  cidade: "",
Â  Â  uf: "",
Â  });


Â  useEffect(() => {
Â  Â  if (initialData && isOpen) {
Â  Â  Â  setClientType(initialData.type || "PF");
Â  Â  Â  setFormData({
Â  Â  Â  Â  id: initialData.id || "",
Â  Â  Â  Â  name: initialData.name || "",
Â  Â  Â  Â  email: initialData.email || "",
Â  Â  Â  Â  telefone: initialData.phone || initialData.telefone || "",
Â  Â  Â  Â  cpf: initialData.cpf || "",
Â  Â  Â  Â  cnpj: initialData.cnpj || "",
Â  Â  Â  Â  rg: initialData.rg || "",
Â  Â  Â  Â  ie: initialData.ie || "",
Â  Â  Â  Â  cep: initialData.cep || "",
Â  Â  Â  Â  logradouro: initialData.logradouro || "",
Â  Â  Â  Â  numero: initialData.numero || "",
Â  Â  Â  Â  complemento: initialData.complemento || "",
Â  Â  Â  Â  bairro: initialData.bairro || "",
Â  Â  Â  Â  cidade: initialData.cidade || "",
Â  Â  Â  Â  uf: initialData.uf || "",
Â  Â  Â  });
Â  Â  } else if (!isOpen) {
Â  Â  Â  setFormData({
Â  Â  Â  Â  id: "",
Â  Â  Â  Â  name: "",
Â  Â  Â  Â  email: "",
Â  Â  Â  Â  telefone: "",
Â  Â  Â  Â  cpf: "",
Â  Â  Â  Â  cnpj: "",
Â  Â  Â  Â  rg: "",
Â  Â  Â  Â  ie: "",
Â  Â  Â  Â  cep: "",
Â  Â  Â  Â  logradouro: "",
Â  Â  Â  Â  numero: "",
Â  Â  Â  Â  complemento: "",
Â  Â  Â  Â  bairro: "",
Â  Â  Â  Â  cidade: "",
Â  Â  Â  Â  uf: "",
Â  Â  Â  });
Â  Â  }
Â  }, [initialData, isOpen]);


Â  const fetchAddressByCep = useCallback(async (cep: string) => {
Â  Â  const cleanCep = cep.replace(/\D/g, "");
Â  Â  if (cleanCep.length === 8) {
Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(`https://viacep.com.br/ws/${cleanCep}/json/`);
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  if (!data.erro) {
Â  Â  Â  Â  Â  setFormData((prev) => ({
Â  Â  Â  Â  Â  Â  ...prev,
Â  Â  Â  Â  Â  Â  logradouro: data.logradouro || "",
Â  Â  Â  Â  Â  Â  bairro: data.bairro || "",
Â  Â  Â  Â  Â  Â  cidade: data.localidade || "",
Â  Â  Â  Â  Â  Â  uf: data.uf || "",
Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro ao buscar CEP:", error);
Â  Â  Â  }
Â  Â  }
Â  }, []);


Â  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
Â  Â  const { name, value } = e.target;
Â  Â  setFormData((prev) => ({ ...prev, [name]: value }));
Â  };


Â  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {
Â  Â  const masked = maskPhone(e.target.value);
Â  Â  setFormData((prev) => ({ ...prev, telefone: masked }));
Â  };


Â  const handleCpfChange = (e: React.ChangeEvent<HTMLInputElement>) => {
Â  Â  const masked = maskCPF(e.target.value);
Â  Â  setFormData((prev) => ({ ...prev, cpf: masked }));
Â  };


Â  const handleCnpjChange = (e: React.ChangeEvent<HTMLInputElement>) => {
Â  Â  const masked = maskCNPJ(e.target.value);
Â  Â  setFormData((prev) => ({ ...prev, cnpj: masked }));
Â  };


Â  const handleCepChange = (e: React.ChangeEvent<HTMLInputElement>) => {
Â  Â  const masked = e.target.value.replace(/\D/g, "").replace(/(\d{5})(\d)/, "$1-$2");
Â  Â  setFormData((prev) => ({ ...prev, cep: masked }));
Â  Â  if (masked.length === 9) {
Â  Â  Â  fetchAddressByCep(masked);
Â  Â  }
Â  };


Â  const handleSubmit = async (e: React.FormEvent) => {
Â  Â  e.preventDefault();
Â  Â  setLoading(true);
Â  Â  try {
Â  Â  Â  const baseData = {
Â  Â  Â  Â  Â  id: formData.id || undefined,
Â  Â  Â  Â  Â  type: clientType,
Â  Â  Â  Â  name: formData.name.trim(),
Â  Â  Â  Â  email: formData.email.trim(),
Â  Â  Â  Â  phone: formData.telefone.replace(/\D/g, ""),
Â  Â  Â  Â  cep: formData.cep.replace(/\D/g, ""),
Â  Â  Â  Â  logradouro: formData.logradouro.trim(),
Â  Â  Â  Â  numero: formData.numero.trim(),
Â  Â  Â  Â  complemento: formData.complemento.trim(),
Â  Â  Â  Â  bairro: formData.bairro.trim(),
Â  Â  Â  Â  cidade: formData.cidade.trim(),
Â  Â  Â  Â  uf: formData.uf.toUpperCase().trim(),
Â  Â  Â  Â  status: "ATIVO",
Â  Â  Â  };


Â  Â  Â  const clientData =
Â  Â  Â  Â  clientType === "PF"
Â  Â  Â  Â  Â  ? {
Â  Â  Â  Â  Â  Â  Â  ...baseData,
Â  Â  Â  Â  Â  Â  Â  cpf: formData.cpf.replace(/\D/g, "") || undefined,
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  : {
Â  Â  Â  Â  Â  Â  Â  ...baseData,


Â  Â  Â  Â  Â  Â  Â  cnpj: formData.cnpj.replace(/\D/g, "") || undefined,
Â  Â  Â  Â  Â  Â  };


Â  Â  Â  console.log("Enviando cliente:", clientData);
Â  Â  Â  await onSubmit(clientData);
Â  Â  Â  onClose();
Â  Â  } catch (error) {
Â  Â  Â  console.error("Erro ao salvar cliente:", error);
Â  Â  Â  alert("Erro: " + JSON.stringify(error));
Â  Â  } finally {
Â  Â  Â  setLoading(false);
Â  Â  }
Â  };


Â  if (!isOpen) return null;


Â  return (
Â  Â  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
Â  Â  Â  <div className="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
Â  Â  Â  Â  <div className="sticky top-0 bg-gradient-to-r from-teal-600 to-teal-700 px-6 py-4 flex justify-between items-center">
Â  Â  Â  Â  Â  <h2 className="text-xl font-bold text-white">{title}</h2>
Â  Â  Â  Â  Â  <button onClick={onClose} className="p-1 hover:bg-white/20 rounded transition-colors">
Â  Â  Â  Â  Â  Â  <X size={24} className="text-white" />
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>


Â  Â  Â  Â  <form onSubmit={handleSubmit} className="p-6 space-y-6">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-3">
Â  Â  Â  Â  Â  Â  Â  Tipo de Cliente *
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  <div className="flex gap-6">
Â  Â  Â  Â  Â  Â  Â  <label className="flex items-center cursor-pointer group">
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="radio"
Â  Â  Â  Â  Â  Â  Â  Â  Â  checked={clientType === "PF"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={() => setClientType("PF")}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-4 h-4 accent-teal-600"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <span className="ml-2 text-gray-700 font-medium group-hover:text-teal-600 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Pessoa FÃ­sica
Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <label className="flex items-center cursor-pointer group">
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="radio"
Â  Â  Â  Â  Â  Â  Â  Â  Â  checked={clientType === "PJ"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={() => setClientType("PJ")}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-4 h-4 accent-teal-600"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <span className="ml-2 text-gray-700 font-medium group-hover:text-teal-600 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Pessoa JurÃ­dica
Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  {clientType === "PF" ? "Nome Completo" : "RazÃ£o Social"} *
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  name="name"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.name}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder={clientType === "PF" ? "JoÃ£o Silva" : "Empresa LTDA"}
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Email *</label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="email"
Â  Â  Â  Â  Â  Â  Â  Â  name="email"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.email}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="contato@email.com"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Telefone *</label>
Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  type="tel"
Â  Â  Â  Â  Â  Â  Â  Â  name="telefone"
Â  Â  Â  Â  Â  Â  Â  Â  value={formData.telefone}
Â  Â  Â  Â  Â  Â  Â  Â  onChange={handlePhoneChange}
Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  maxLength={15}
Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="(11) 99999-9999"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  {clientType === "PF" ? (
Â  Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">CPF *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name="cpf"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cpf}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleCpfChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={14}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="123.456.789-00"
Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">RG</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name="rg"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.rg}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="12.345.678-9"
Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">CNPJ *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name="cnpj"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cnpj}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleCnpjChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={18}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="12.345.678/0001-90"
Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  InscriÃ§Ã£o Estadual
Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name="ie"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.ie}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="123.456.789.012"
Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  <div className="border-t pt-6">
Â  Â  Â  Â  Â  Â  <h3 className="text-lg font-semibold text-gray-800 mb-4">EndereÃ§o</h3>
Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">CEP *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="cep"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cep}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleCepChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={9}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="12345-678"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-3">
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Rua *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="logradouro"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.logradouro}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Rua das Flores"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">NÃºmero *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="numero"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.numero}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="123"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Complemento
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="complemento"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.complemento}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Apto 42"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Bairro *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="bairro"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.bairro}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Centro"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">Cidade *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="cidade"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.cidade}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="SÃ£o Paulo"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-semibold text-gray-700 mb-1">UF *</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  name="uf"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={formData.uf}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={handleInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={2}
Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent uppercase"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="SP"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>


Â  Â  Â  Â  Â  <div className="flex gap-4 justify-end pt-4 border-t">
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  Â  onClick={onClose}
Â  Â  Â  Â  Â  Â  Â  disabled={loading}
Â  Â  Â  Â  Â  Â  Â  className="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors disabled:opacity-50"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  type="submit"
Â  Â  Â  Â  Â  Â  Â  disabled={loading}
Â  Â  Â  Â  Â  Â  Â  className="flex items-center gap-2 px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 font-medium transition-colors disabled:opacity-50"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <Save size={18} />
Â  Â  Â  Â  Â  Â  Â  {loading ? "Salvando..." : "Salvar Cliente"}
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}

analise so que melhroando em alguns caso e corrigidno os bugs e arquivos que flatam 