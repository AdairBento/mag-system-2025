generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== USERS ====================
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(USER)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

enum UserRole {
  ADMIN
  MANAGER
  USER
}

// ==================== CLIENTS ====================
model Client {
  id              String       @id @default(uuid())
  type            ClientType
  status          ClientStatus @default(ATIVO)

  // Individual Person (PF)
  name            String?
  cpf             String?      @unique
  rg              String?
  birthDate       DateTime?

  // Company (PJ)
  companyName     String?
  cnpj            String?      @unique
  tradeName       String?
  stateRegistration String?

  // Contact (Common)
  cellphone       String?
  telephone       String?
  email           String?

  // Address (Common)
  zipCode         String?
  street          String?
  number          String?
  complement      String?
  neighborhood    String?
  city            String?
  state           String?

  // Driver License (for rental)
  licenseNumber   String?
  licenseCategory String?
  licenseExpiry   DateTime?

  // Notes
  notes           String?

  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // Relations
  rentals         Rental[]
  drivers         Driver[]

  @@map("clients")
}

enum ClientType {
  PF // Individual Person
  PJ // Company
}

enum ClientStatus {
  ATIVO
  INATIVO
  BLOQUEADO
}

// ==================== DRIVERS ====================
model Driver {
  id              String       @id @default(uuid())
  name            String
  cpf             String       @unique
  email           String?
  licenseNumber   String?
  licenseCategory String?
  licenseExpiry   DateTime?
  phone           String?
  cellphone       String?
  status          DriverStatus @default(ATIVO)
  clientId        String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // Relations
  client          Client?      @relation(fields: [clientId], references: [id])

  @@map("drivers")
}

enum DriverStatus {
  ATIVO
  INATIVO
}

// ==================== VEHICLES ====================
model Vehicle {
  id              String        @id @default(uuid())
  plate           String        @unique
  brand           String
  model           String
  year            Int
  modelYear       Int?
  color           String?
  mileage         Int           @default(0)
  renavam         String?       @unique
  chassi          String?       @unique
  status          VehicleStatus @default(DISPONIVEL)
  category        String?       // SUV, Sedan, Hatch, etc
  fuelType        String?       // Gasoline, Ethanol, Flex, Diesel

  // Rental values
  dailyRate       Float         @default(0)
  weeklyRate      Float         @default(0)
  monthlyRate     Float         @default(0)

  // IPVA and Insurance
  ipvaAmount      Float?
  ipvaExpiry      DateTime?
  insuranceAmount Float?
  insuranceExpiry DateTime?

  // Notes
  notes           String?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  rentals         Rental[]
  maintenances    Maintenance[]

  @@map("vehicles")
}

enum VehicleStatus {
  DISPONIVEL
  LOCADO
  MANUTENCAO
  INATIVO
}

// ==================== RENTALS ====================
model Rental {
  id              String        @id @default(uuid())
  clientId        String
  vehicleId       String
  status          RentalStatus  @default(ATIVA)

  // Dates
  startDate       DateTime
  endDate         DateTime
  pickupDate      DateTime?
  returnDate      DateTime?

  // Values
  dailyRate       Float
  rentalDays      Int
  totalAmount     Float
  paidAmount      Float         @default(0)
  pendingAmount   Float         @default(0)

  // Mileage
  startMileage    Int?
  endMileage      Int?
  mileageDriven   Int?

  // Fuel
  fuelOnPickup    String?       // Full, 3/4, Half, etc
  fuelOnReturn    String?

  // Notes
  notes           String?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  client          Client        @relation(fields: [clientId], references: [id])
  vehicle         Vehicle       @relation(fields: [vehicleId], references: [id])

  @@map("rentals")
}

enum RentalStatus {
  ATIVA
  FINALIZADA
  CANCELADA
  ATRASADA
}

// ==================== MAINTENANCE ====================
model Maintenance {
  id            String            @id @default(uuid())
  vehicleId     String
  type          MaintenanceType
  description   String
  amount        Float?
  startDate     DateTime
  endDate       DateTime?
  status        MaintenanceStatus @default(PENDENTE)
  workshop      String?
  notes         String?

  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  // Relations
  vehicle       Vehicle           @relation(fields: [vehicleId], references: [id])

  @@map("maintenances")
}

enum MaintenanceType {
  PREVENTIVA
  CORRETIVA
  REVISAO
  SINISTRO
}

enum MaintenanceStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
}
